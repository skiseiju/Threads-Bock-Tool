# Changelog

所有版本的重大變更紀錄。每個條目的第一句話為 TL;DR 摘要。

## v2.0.7 — iOS/iPadOS 同分頁封鎖 & 同列全封

*   **iOS/iPadOS 同分頁封鎖**：全新「Same-Tab Worker」機制，在 Safari 中以 `history.replaceState` + `reload` 方式執行背景封鎖，徹底避免 Universal Links 開啟原生 Threads App、彈出視窗被攔截、以及 iframe 無法注入 UserScript 等 iOS 限制。封鎖完成後自動返回原頁面。
*   **同列全封按鈕**：針對「按讚」或「轉發」等互動名單視窗，新增一鍵「同列全封」按鈕。可一鍵將彈出視窗內所有符合條件的使用者加入背景封鎖排隊。
*   **排除自我帳號**：掃描時自動略過使用者本人的帳號，不再顯示勾選框。透過 `Utils.getMyUsername()` 智能判斷，防止誤鎖自己。
*   **渲染效能提升**：在建立 DOM 勾選框之前提前進行過濾（Early-return），減少無效渲染。

## v2.0.6 — Shift 連鎖選取

*   **Shift 連鎖選取**：新增 `Shift + 點擊` 批次選取功能。按住 Shift 點擊可一次勾選或取消範圍內所有帳號。
*   **強制事件捕獲**：改用 `Capture Phase` 委派，解決 Safari Userscript 環境下點擊被 React 吞噬的問題。

## v2.0.5 — 全局同步修正

*   **修正背景封鎖完成後主選單數字凍結**：改以資料庫作全局比對，確保貼文滑出畫面後數字仍正確更新。
*   **對話框嚴格誤判防護**：嚴格要求必須點擊紅色按鈕或含「封鎖」字樣的按鈕，避免誤點警告視窗的「關閉」。

## v2.0.4 — 快取深拷貝修正

*   **記憶體快取深拷貝**：修正背景執行緒寫入歷史紀錄時意外修改快取本體，導致跨分頁同步失效的底層問題。

## v2.0.3 — DOM 查詢範圍還原

*   **修正「更多」按鈕搜尋範圍**：還原前版為效能而侷限在 `<header>` 內的搜尋範圍，解決部分個人檔案頁面封鎖失敗的問題。

## v2.0.2 — 快取強迫清除

*   **快取強迫清除機制**：修正主分頁接收到跨頁 Storage 事件後仍讀取舊快取的問題。

## v2.0.1 — 失敗重試機制

*   **真失敗重試機制**：區分「成功封鎖」、「已封鎖(跳過)」與「真失敗」，真失敗帳號進入專屬佇列可一鍵重試。
*   **失敗重試按鈕**：控制面板新增「重試失敗清單」按鈕，一鍵重新將失敗帳號送回背景排隊列。
*   **智慧名單匯入**：自動淨化 URL 追蹤參數，過濾正在排隊中的帳號。
*   **響應式佈局適配**：調整背景視窗尺寸上限 (800x600)，解決過小視窗導致「找不到更多按鈕」的問題。

## v2.0.0 — 模組化重構

*   **專案重構**：全面模組化，拆分為 config / utils / storage / ui / core / worker / main 七個模組。
*   **Chrome 擴充功能支援**：新增 `manifest.json`，支援以 Chrome Extension 形式安裝。
*   **自動化建置**：`build.sh` 一鍵產出 UserScript、Chrome Extension、Safari 部署。

### v2.0.0-alpha7
*   移除介面上的 Debug Log 區塊，所有除錯訊息改為僅輸出至瀏覽器 Console (`F12`)。

### v2.0.0-alpha6
*   修正 `manifest.json`，追加支援 `threads.com` 網域。
*   恢復匯入/匯出功能、模式切換狀態顯示、啟動環境日誌。

### v2.0.0-alpha5
*   修復 Chrome 擴充功能 UI 消失問題 (Trusted Types / DOMContentLoaded)。

### v2.0.0-alpha4
*   修復 iOS 前景封鎖失效問題 (完整移植 beta46 邏輯)。

### v2.0.0-alpha1 ~ alpha3
*   專案重構、自動化建置、Chrome 修正、UI 定位修復。

---

## v1.x Legacy

### v1.1.3 Beta Series
*   **beta46**: 修正 Android 裝置上點擊按鈕可能觸發 App 跳轉的問題。
*   **beta45**: 全面改用 `simClick` 模擬點擊，提升相容性。
*   **beta44**: 優化行動版裝置偵測，避免在手機上顯示桌面版 UI。
*   **beta38**: 加入 `BroadcastChannel` 讓背景執行緒的 Log 能同步顯示在 UI 上 (v2.0 已移除)。
*   **beta34**: 增強前景模式的「已封鎖」偵測，自動跳過並標記成功。
*   **beta33**: 修正 macOS 上因 `TouchEvent` 檢查導致的崩潰。
*   **beta32**: 加入桌面版的前景/背景模式切換開關。
*   **beta29**: 解鎖歷史紀錄限制，允許對已在清單中的用戶重新排程。
*   **beta25**: 新增介面 Debug Console (Console Log UI)。
*   **beta24**: 優化 iOS 裝置 (iPad) 的偵測邏輯。
*   **beta23**: 將 v1.1.2 的穩定前景封鎖邏輯移植回 Beta 版。
*   **beta18**: 重寫 UI 面板定位邏輯 (Anchor)，自動對齊 Threads 選單按鈕。
*   **beta17**: 改用 Native 風格的選單樣式。
*   **beta6**: 改用彈出視窗 (Popup Window) 執行背景任務，解決背景分頁休眠問題。

### v1.1.2
*   「持久化冷卻鎖定」加入誤判解決鎖定功能。

### v1.1.1
*   新增「持久化冷卻鎖定」：觸發限制後強制鎖定 12 小時，防止使用者透過重整網頁繞過警告。鎖定期間全面禁用匯入與執行功能。

### v1.1.0 (Major Update) - 2024.05
*   新增「封鎖失敗偵測」功能：監控 Rate Limit 訊息與確認視窗卡死，觸發風險時自動切換為「⛔ 限制暫停中」狀態。
*   微幅增加操作間隔延遲，提升模擬真人的真實度。

### v1.0.9
*   Chrome/Edge 兼容性修復：解決因 CSP (TrustedHTML) 安全政策導致腳本無法執行的問題。
*   排除「為你推薦」等直欄標題旁誤出現勾選框的問題。

### v1.0.8
*   強化 SVG 尺寸過濾機制（排除 < 16px 的小型系統按鈕）。排除「新增為直欄」按鈕誤判。

### v1.0.7
*   排除「新增為直欄」等小型系統按鈕的誤判。加入 SVG 尺寸過濾機制。

### v1.0.6
*   重大視覺升級：捨棄舊式 Checkbox，改用與 Threads 風格融合的原生 SVG 圓角選取鈕。新增 Hover 回饋效果。

### v1.0.5
*   精準圖示辨識：透過 SVG 內部標籤區分「設定」與「貼文」按鈕。加大按鈕推擠間距至 45px。

### v1.0.4
*   改用 CSS Transform 強制位移按鈕。增強 SVG `aria-label` 過濾邏輯。

### v1.0.3
*   修正含有文字的按鈕誤出現勾選框的問題。優化手機版邊緣顯示。

### v1.0.2
*   防誤觸優化：勾選框移至按鈕右側獨立懸浮區。封鎖後貼文改為 Opacity 淡化而非隱藏。

### v1.0.1
*   修正勾選框擠壓版面問題（改用 Absolute 定位）。改以 User ID 去重，解決數量虛胖問題。

### v1.0.0 (Initial Release)
*   正式命名為「留友封」。整合歷史資料庫、匯入/匯出功能。確立「時間延遲」機制確保執行穩定性。
