# Changelog

所有版本的重大變更紀錄。每個條目的第一句話為 TL;DR 摘要。

## v2.0.7 — iOS/iPadOS 同分頁封鎖 & 同列全封

*   **iOS/iPadOS 同分頁封鎖**：全新「Same-Tab Worker」機制，在 Safari 中以 `history.replaceState` + `reload` 方式執行背景封鎖，徹底避免 Universal Links 開啟原生 Threads App、彈出視窗被攔截、以及 iframe 無法注入 UserScript 等 iOS 限制。封鎖完成後自動返回原頁面。
*   **同列全封按鈕**：針對「按讚」或「轉發」等互動名單視窗，新增一鍵「同列全封」按鈕。可一鍵將彈出視窗內所有符合條件的使用者加入背景封鎖排隊。
*   **排除自我帳號**：掃描時自動略過使用者本人的帳號，不再顯示勾選框。透過 `Utils.getMyUsername()` 智能判斷，防止誤鎖自己。
*   **渲染效能提升**：在建立 DOM 勾選框之前提前進行過濾（Early-return），減少無效渲染。

## v2.0.6 — Shift 連鎖選取

*   **Shift 連鎖選取**：新增 `Shift + 點擊` 批次選取功能。按住 Shift 點擊可一次勾選或取消範圍內所有帳號。
*   **強制事件捕獲**：改用 `Capture Phase` 委派，解決 Safari Userscript 環境下點擊被 React 吞噬的問題。

## v2.0.5 — 全局同步修正

*   **修正背景封鎖完成後主選單數字凍結**：改以資料庫作全局比對，確保貼文滑出畫面後數字仍正確更新。
*   **對話框嚴格誤判防護**：嚴格要求必須點擊紅色按鈕或含「封鎖」字樣的按鈕，避免誤點警告視窗的「關閉」。

## v2.0.4 — 快取深拷貝修正

*   **記憶體快取深拷貝**：修正背景執行緒寫入歷史紀錄時意外修改快取本體，導致跨分頁同步失效的底層問題。

## v2.0.3 — DOM 查詢範圍還原

*   **修正「更多」按鈕搜尋範圍**：還原前版為效能而侷限在 `<header>` 內的搜尋範圍，解決部分個人檔案頁面封鎖失敗的問題。

## v2.0.2 — 快取強迫清除

*   **快取強迫清除機制**：修正主分頁接收到跨頁 Storage 事件後仍讀取舊快取的問題。

## v2.0.1 — 失敗重試機制

*   **真失敗重試機制**：區分「成功封鎖」、「已封鎖(跳過)」與「真失敗」，真失敗帳號進入專屬佇列可一鍵重試。
*   **智慧名單匯入**：自動淨化 URL 追蹤參數，過濾正在排隊中的帳號。
*   **響應式佈局適配**：調整背景視窗尺寸上限 (800x600)，解決過小視窗導致「找不到更多按鈕」的問題。

## v2.0.0 — 模組化重構

*   **專案重構**：全面模組化，拆分為 config / utils / storage / ui / core / worker / main 七個模組。
*   **Chrome 擴充功能支援**：新增 `manifest.json`，支援以 Chrome Extension 形式安裝。
*   **自動化建置**：`build.sh` 一鍵產出 UserScript、Chrome Extension、Safari 部署。
